{% extends "base.html" %}

{% block content %}
<h2>{{ item.name }} - Tracking Map</h2>
<p>Last scanned: {{ locations[0].time if locations else 'Never' }}</p>

<div id="map" style="height: 500px; width: 100%;"></div>

<div class="mt-3">
    {% if locations and locations[0].ip %}
    {# Show scan history (specific item) #}
    <h4>Scan History for {{ item.name }}</h4>
    <ul>
        {% for scan in locations %}
            <li>{{ scan.time }} - IP: {{ scan.ip }}</li>
        {% endfor %}
    </ul>
{% else %}
    {# Show list of items (general map) #}
    <h4>All Items</h4>
    <ul>
        {% for item in locations %}
            <li><a href="{{ url_for('item_map', item_id=item.id) }}">{{ item.name }}</a></li>
        {% endfor %}
    </ul>
{% endif %}
</div>

{% endblock %}

{% block scripts %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script src="{{ url_for('static', filename='js/map.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const center = {{ center|tojson }};
        const locations = {{ locations|tojson }};
        initMap(center, locations);
    });
</script>
{% endblock %}