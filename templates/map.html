{% extends "base.html" %}

{% block content %}
<h2>{{ item.name }} - Tracking Map</h2>
<p>Last scanned: {% if locations and locations[0].ip %}{{ locations[0].time }}{% else %}Never{% endif %}</p>

<div id="map" style="height: 500px; width: 100%;"></div>

<div class="mt-3">
    {% if locations and locations[0].ip %}
    {# Show scan history (specific item) #}
    <h4>Scan History for {{ item.name }}</h4>
    <ul class="list-group">
        {% for scan in locations %}
            <li class="list-group-item">{{ scan.time }} - IP: {{ scan.ip }}</li>
        {% endfor %}
    </ul>
    {% elif locations %}
    {# Show list of items (general map) #}
    <h4>All Items</h4>
    <ul class="list-group">
        {% for item in locations %}
            <li class="list-group-item">
                <a href="{{ url_for('item_map', item_id=item.id) }}">{{ item.name }}</a>
            </li>
        {% endfor %}
    </ul>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script src="{{ url_for('static', filename='js/map.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        {% if map_data %}
        initMap({{ map_data|tojson }});
        {% endif %}
    });
</script>
{% endblock %}